version: '3.8'
services:
  
  dynamodb-local:
    command: "-jar DynamoDBLocal.jar -sharedDb -dbPath ./data"
    image: "amazon/dynamodb-local:latest"
    container_name: dynamodb-local
    ports:
      - "8000:8000"
    volumes:
      - "./docker/dynamodb:/home/dynamodblocal/data"
    working_dir: /home/dynamodblocal

  dynamodb-admin:
    image: aaronshaf/dynamodb-admin
    ports:
      - "8001:8001"
    environment:
      DYNAMO_ENDPOINT: "http://dynamodb-local:8000"
      AWS_REGION: "us-west-2"
      AWS_ACCESS_KEY_ID: access_key_id
      AWS_SECRET_ACCESS_KEY: access_key
    depends_on:
      - dynamodb-local

  redis-cluster:
    image: grokzen/redis-cluster:latest
    environment:
      REDIS_CLUSTER_IP: 0.0.0.0
      IP: 0.0.0.0
    volumes:
      - "./log:/var/log"
    ports:
    - "7000-7005:7000-7005"

  xray-daemon:
    command: -o
    build: ./xray_daemon
    environment:
      AWS_REGION: ap-east-1
      AWS_ACCESS_KEY_ID: ${XRAY_AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${XRAY_AWS_SECRET_ACCESS_KEY}
    volumes:
      - "./log:/var/log"
    ports:
      - 2000:2000
      - 2000:2000/udp

  redis-commander:
    container_name: redis-commander
    hostname: redis-commander
    image: rediscommander/redis-commander:latest
    restart: always
    depends_on:
      - redis-cluster
    environment:
      - REDIS_HOSTS=local:redis-cluster:7000
    ports:
      - "8882:8081"
